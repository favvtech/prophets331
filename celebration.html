<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Celebration</title>
  <link rel="preload" href="Styles/prophets.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="Styles/prophets.css"></noscript>
  <style>
    html, body { height: 100%; }
    body { display: block; min-height: 100vh; margin: 0; background: var(--bg); overflow: auto; }
    .overlay {
      position: fixed; inset: 0; pointer-events: none;
      background: radial-gradient(1200px 600px at 50% -10%, rgba(59,130,246,0.15), transparent 60%),
                  radial-gradient(1200px 600px at 50% 110%, rgba(59,130,246,0.12), transparent 60%);
    }
    .celebration {
      position: relative; text-align: center; max-width: none; padding: 1rem; z-index: 1;
      opacity: 1;
      transform: none;
    }
    .headline {
      font-size: clamp(1.5rem, 3.5vw, 2.5rem);
      margin: 0 0 1rem; line-height: 1.1; letter-spacing: -0.02em;
      background: linear-gradient(90deg, #1f2937, #3b82f6, #1f2937);
      -webkit-background-clip: text; background-clip: text; color: transparent;
      animation: shimmer 2.5s linear infinite;
    }
    .card {
      background: var(--card-bg); border: 1px solid var(--border); border-radius: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06), 0 10px 24px rgba(0,0,0,0.08);
      overflow: hidden; text-align: left;
      opacity: 1;
      transform: none;
    }
    .card img { display: block; width: 100%; height: auto; }
    .card .meta { padding: 1rem; color: var(--muted); }
    canvas#confetti { position: fixed; inset: 0; width: 100%; height: 100%; pointer-events: none; }
    canvas#fireworks { position: fixed; inset: 0; width: 100%; height: 100%; pointer-events: none; }
    .actions { margin-top: 0.75rem; display: inline-flex; gap: 0.5rem; }
    .actions button {
      padding: 0.5rem 0.75rem; border-radius: 999px; border: 1px solid var(--border); background: #fff; cursor: pointer;
      box-shadow: 0 1px 2px rgba(0,0,0,0.04);
    }
    @keyframes shimmer { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px);} to { opacity:1; transform:none;} }
    @keyframes floatUp { from { opacity: 0; transform: translateY(12px);} to { opacity:1; transform:none;} }
    /* Desktop & tablets (>=768px): center card, limit size */
    @media (min-width: 768px) {
      body { display: flex; justify-content: center; align-items: center; }
      .card {
        max-width: 700px;
        max-height: 90vh;
        overflow: hidden;
        margin: 20px;
        padding: 20px;
      }
      .card img {
        max-width: 100%;
        max-height: 60vh;
        height: auto;
        border-radius: 12px;
        object-fit: contain;
      }
    }

    /* Mobile (<=767px): normal flow and scrolling */
    @media (max-width: 767px) {
      body { display: block; }
      .card { max-width: 95%; max-height: none; margin: 20px auto; }
      .card img { max-height: none; }
      #save { display: none; }
    }
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>
  <canvas id="fireworks"></canvas>
  <div class="overlay"></div>
  <div class="celebration">
    <h1 id="headline" class="headline">Russell M. Nelson @ 101 Today</h1>
    <div class="card" id="card">
      <img id="portrait" alt="Portrait of Russell M. Nelson" loading="eager" width="340" height="440"/>
      <div class="meta">
        <p id="dob">Date of Birth: 9 September 1924</p>
        <p id="pob">Place of Birth: Utah</p>
      </div>
    </div>
    <div class="actions" role="toolbar" aria-label="Sharing and controls">
      <button id="share">Share</button>
      <button id="copy">Copy link</button>
      <button id="save">Save as image</button>
    </div>
  </div>
  <script>
    // Immediate content update for faster display
    const params = new URLSearchParams(window.location.search);
    const name = params.get('name') || 'Russell M. Nelson';
    const imageurl = params.get('imageurl');
    const birthdate = params.get('birthdate') || '9 September 1924';
    const birthplace = params.get('birthplace') || 'Utah';
    
    // Update content immediately without waiting for DOM
    if (imageurl) {
      const img = document.getElementById('portrait');
      img.src = imageurl;
      img.alt = `Portrait of ${name}`;
    }
    document.getElementById('headline').textContent = `${name} @ 101 Today`;
    document.getElementById('dob').textContent = `Date of Birth: ${birthdate}`;
    document.getElementById('pob').textContent = `Place of Birth: ${birthplace}`;

    // Defer animations to avoid blocking initial render
    requestAnimationFrame(() => {
      const canvas = document.getElementById('confetti');
      const ctx = canvas.getContext('2d');
      let W, H; function resize(){ W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; } resize();
      window.addEventListener('resize', resize);
      const colors = ['#3b82f6','#22c55e','#f59e0b','#ef4444','#a855f7','#06b6d4'];
      const pieces = Array.from({length: 150}).map(() => ({
        x: Math.random()*W,
        y: Math.random()*-H,
        r: Math.random()*6+2,
        c: colors[Math.floor(Math.random()*colors.length)],
        s: Math.random()*1.5+0.8,
        a: Math.random()*Math.PI*2
      }));
      function draw(){
        ctx.clearRect(0,0,W,H);
        for(const p of pieces){
          p.y += p.s*1.5; p.x += Math.sin((p.y+p.a)/50)*0.8; p.a += 0.015;
          if(p.y>H+20){ p.y = -20; p.x = Math.random()*W; }
          ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(Math.sin(p.a)*0.3);
          ctx.fillStyle=p.c; ctx.fillRect(-p.r*0.5,-p.r*0.5,p.r,p.r);
          ctx.restore();
        }
        requestAnimationFrame(draw);
      }
      draw();
    });

    // Defer fireworks to avoid blocking initial render
    setTimeout(() => {
      const fw = document.getElementById('fireworks');
      const fctx = fw.getContext('2d');
      function resizeFW(){ fw.width = window.innerWidth; fw.height = window.innerHeight; } resizeFW();
      window.addEventListener('resize', resizeFW);
      const bursts = [];
      function spawnFirework(){
        const x = Math.random()*fw.width;
        const y = Math.random()*fw.height*0.4 + fw.height*0.1;
        const color = colors[Math.floor(Math.random()*colors.length)];
        const particles = Array.from({length: 25}).map(() => ({
          x, y,
          vx: (Math.random()*2-1)*2.5,
          vy: (Math.random()*2-1)*2.5,
          life: 45,
          color
        }));
        bursts.push({particles});
      }
      setInterval(spawnFirework, 2500);
      function drawFW(){
        fctx.clearRect(0,0,fw.width,fw.height);
        for(const b of bursts){
          for(const p of b.particles){
            p.x += p.vx; p.y += p.vy; p.vy += 0.015; p.life -= 1;
            fctx.globalAlpha = Math.max(p.life/45, 0);
            fctx.fillStyle = p.color; fctx.fillRect(p.x, p.y, 1.5, 1.5);
          }
          b.particles = b.particles.filter(p=>p.life>0);
        }
        for (let i = bursts.length-1; i>=0; i--) if (bursts[i].particles.length===0) bursts.splice(i,1);
        requestAnimationFrame(drawFW);
      }
      drawFW();
    }, 100);

    // Actions: share/copy/save/mute
    const link = window.location.href;
    document.getElementById('copy').addEventListener('click', async () => {
      try { await navigator.clipboard.writeText(link); alert('Link copied!'); } catch {}
    });
    document.getElementById('share').addEventListener('click', async () => {
      if (navigator.share) {
        try { await navigator.share({ title: document.title, url: link }); } catch {}
      } else {
        try { await navigator.clipboard.writeText(link); alert('Link copied!'); } catch {}
      }
    });

    document.getElementById('save').addEventListener('click', async () => {
      // Portrait-only save (previous behavior)
      try {
        const src = document.getElementById('portrait').src;
        const res = await fetch(src, { mode: 'cors' });
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'portrait.png'; a.click();
        setTimeout(() => URL.revokeObjectURL(url), 1500);
      } catch {
        window.open(document.getElementById('portrait').src, '_blank');
      }
    });
  </script>
</body>
</html>


